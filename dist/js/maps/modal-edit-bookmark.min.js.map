{"version":3,"names":[],"mappings":"","sources":["modal-edit-bookmark.js"],"sourcesContent":["'use strict'\n\nconst i18n \t\t\t= require( './i18n.min' )\n\nconst remote \t\t= require( 'electron' ).remote\nconst ipc \t\t\t= require( 'electron' ).ipcRenderer\nconst dialog \t\t= remote.dialog\n\nconst Store \t\t= require( 'electron-store' )\nconst store \t\t= new Store()\nconst Mousetrap \t= require( 'mousetrap' )\n\nconst $ \t\t\t= require( 'jquery' )\nconst jqueryI18next = require( 'jquery-i18next' )\n\njqueryI18next.init(i18n, $)\nrequire('select2')($)\n\nconst fetch\t\t\t= require( './fetch.min' )\nconst serialize\t\t= require( './serialize.min' )\nconst entities\t\t= require( './entities.min' )\n\nconst \turlParams = new URLSearchParams( location.search ),\n\t\ttheId = urlParams.get('id')\n\n\n\n//note(dgmid): log exceptions\n\nwindow.onerror = function( error, url, line ) {\n\t\n\tipcRenderer.send( 'error-in-render', {error, url, line} )\n}\n\n\n\n//note(dgmid): set lang & localize strings\n\n$('html').attr('lang', i18n.language)\n$('header span').localize()\n$('label').localize()\n$('input').localize()\n$('button').localize()\n\n\n\n//note(dgmid): register kbd shortcut\nMousetrap.bind('command+.', function() {\n\t\n\tcloseModal()\n})\n\n\n\n//note(dgmid): populate form\n\nfunction populateForm( bookmark ) {\n\t\n\t$('header').append( entities.encode( bookmark['item']['title'] ) )\n\t$('input[name=\"url\"]').val( bookmark['item']['url'] )\n\t$('input[name=\"title\"]').val( bookmark['item']['title'] )\n\t$('textarea[name=\"description\"]').val( bookmark['item']['description'] )\n\t\n\t//note(dgmid): set any active tags\n\t\n\tlet activeTags = []\n\tconst allTags = store.get('tags')\n\t\n\tfor (var i = 0; i < allTags.length; i++) {\n\t\t\n\t\tif( bookmark['item']['tags'].indexOf( allTags[i]['text'] ) > -1 ) {\n\t\t\t\n\t\t\tactiveTags.push( allTags[i]['id'] )\n\t\t}\n\t}\n\t\n\t$('#tags').val( activeTags )\n\t$('#tags').trigger( 'change' )\n}\n\n\n\n//note(dgmid): close modal\n\nfunction closeModal() {\n\t\n\tconst modal = remote.getCurrentWindow()\n\tmodal.close()\n}\n\n\n\n$(document).ready(function() {\n\t\n\t$('#tags').select2({\n\t\ttheme: \"custom\",\n\t\twidth: '320px',\n\t\ttags: true,\n\t\ttokenSeparators: [',',';'],\n\t\tdata: store.get('tags')\n\t})\n\t\n\t\n\tfetch.bookmarksApi( 'single', theId, '', function( message ) {\n\t\t\n\t\tpopulateForm( JSON.parse( message ) )\n\t})\n\t\n\t\n\t//note(dgmid): cancel modal\n\t\n\t$('#cancel').click( function() {\n\t\t\n\t\tcloseModal()\n\t})\n\t\n\t\n\t//note(dgmid): update data\n\t\n\t$('#modal-form').submit( function( e ) {\n\t\t\n\t\te.preventDefault()\n\t\t\n\t\tlet data = '?'\n\t\t\n\t\tdata += serialize.serialize({\n\t\n\t\t\t'record_id': theId,\n\t\t\t'url': $('input[name=\"url\"]').val(),\n\t\t\t'title': $('input[name=\"title\"]').val(),\n\t\t\t'description': $('textarea[name=\"description\"]').val()\n\t\t})\n\t\t\n\t\tconst tags = $('#tags').select2('data')\n\t\t\n\t\tfor (var i = 0; i < tags.length; i++) {\n\t\t\t\n\t\t\tdata += '&item[tags][]=' + encodeURIComponent(tags[i]['text'])\n\t\t}\n\t\t\n\t\tfetch.bookmarksApi( 'modify', theId, data, function() {\n\t\t\t\n\t\t\tipc.send('refresh', 'refresh')\n\t\t\tcloseModal()\n\t\t})\n\t})\n})\n"],"file":"../modal-edit-bookmark.min.js"}